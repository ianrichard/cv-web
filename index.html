<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Web Detection</title>
    <!-- Use TensorFlow.js 3.x with explicit backends -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-cpu@3.20.0/dist/tf-backend-cpu.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@3.20.0/dist/tf-backend-webgl.min.js"></script>
    <!-- COCO-SSD for object detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
    <!-- BlazeFace for face detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>
    <link rel="stylesheet" href="src/styles/main.css">
</head>
<body>
    <div class="main-container panel-open">
        <!-- Large Camera View (Top 3/4) -->
        <div class="camera-section">
            <div class="video-container">
                <video id="webcam" autoplay muted playsinline></video>
                <canvas id="output"></canvas>
            </div>
        </div>

        <!-- Bottom Panel (Start Expanded) -->
        <div class="bottom-panel expanded" id="bottomPanel">
            <!-- FAB Toggle Button -->
            <button class="fab-toggle" id="fabToggle">
                <div class="fab-icon">
                    <span class="line line1"></span>
                    <span class="line line2"></span>
                </div>
            </button>

            <!-- Left Column: Metrics -->
            <div class="metrics-section">
                <h3>Metrics</h3>
                <div class="metrics-controls">
                    <span id="statusText">Initializing...</span>
                    <button id="toggleDetectionBtn" disabled>Start Detection</button>
                </div>
                <div class="metrics-table">
                    <div class="metric-row">
                        <span class="metric-label">Mode:</span>
                        <span id="currentMode">Objects</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Status:</span>
                        <span id="detectionStatus">Stopped</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">FPS:</span>
                        <span id="fpsCounter">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Inference:</span>
                        <span id="inferenceTime">0ms</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Objects:</span>
                        <span id="objectCount">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Filters:</span>
                        <span id="activeFilters">All (80)</span>
                    </div>
                </div>
            </div>

            <!-- Right Column: Demo Settings -->
            <div class="demo-section">
                <div class="demo-header">
                    <h3>Demo Settings</h3>
                </div>

                <!-- Demo Mode Tabs -->
                <div class="demo-tabs">
                    <button class="demo-tab active" data-tab="objects">Objects</button>
                    <button class="demo-tab" data-tab="face">Face</button>
                </div>

                <!-- Objects Tab Content -->
                <div class="demo-content" id="objects-content">
                    <div class="tab-header">
                        <h4>Object Detection Filters</h4>
                        <div class="filter-actions">
                            <button id="selectAllBtn">Select All</button>
                            <button id="selectNoneBtn">Clear All</button>
                        </div>
                    </div>
                    <div class="filters-content">
                        <div class="tag-grid" id="tagGrid">
                            <!-- Tags will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Face Tab Content -->
                <div class="demo-content" id="face-content" style="display: none;">
                    <div class="tab-header">
                        <h4>Face Recognition</h4>
                    </div>
                    <div class="face-settings">
                        <div class="reference-image-section">
                            <label class="reference-label">Reference Image:</label>
                            <div class="image-upload-area">
                                <div class="current-reference" id="currentReference">
                                    <img id="referencePreview" src="/images/face.jpg" alt="Reference face"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                    <div class="no-image" style="display: none;">No reference image</div>
                                </div>
                                <div class="upload-controls">
                                    <input type="file" id="referenceUpload" accept="image/*" style="display: none;">
                                    <button id="uploadReferenceBtn">Upload New</button>
                                    <button id="resetReferenceBtn">Reset to Default</button>
                                </div>
                            </div>
                        </div>

                        <div class="face-options">
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="showAllFaces" checked>
                                    <span>Show all detected faces</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="highlightMatches" checked>
                                    <span>Highlight reference matches</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>Similarity threshold:</label>
                                <input type="range" id="similarityThreshold" min="0.3" max="0.9" step="0.1" value="0.7">
                                <span id="thresholdValue">0.7</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="src/app.js"></script>
</body>
</html>